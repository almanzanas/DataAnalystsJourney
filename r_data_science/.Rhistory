group_by(Major_category) %>%
summarize(mean_college_jobs_pct = mean(College_jobs_pct)) %>%
arrange(desc(mean_college_jobs_pct))
df.clean <- df.clean %>%
group_by(Major_category) %>%
mutate( Salary_mdn = median(Median) )
ggplot(data = df.clean) +
geom_boxplot( aes( x = reorder(Major_category, Salary_mdn),
y = Median),
fill = "lightblue", color = "darkblue") +
labs( x = "Major_category" ) +
ggtitle ("Median by Major Category") +
theme( axis.text.x = element_text( angle = 45, hjust = 1.2 ) ) +
expand_limits( x = c(0, NA), y = c(0, NA) ) +
scale_y_continuous( labels = scales::comma )
pairwise.wilcox.test(df.clean$Median, df.clean$Major_category, p.adjust.method = "holm") %>% suppressWarnings()
#cor(df.clean$ShareWomen, df.clean$Unemployment_rate, method = "pearson")
cor(df.clean$ShareWomen, df.clean$Unemployment_rate,
method = "spearman")
ggplot( data = df.clean ) +
geom_point( aes( x = ShareWomen, y = Unemployment_rate ),
color = "darkblue") +
ggtitle ("Share of women vs. Unemployment rate") +
labs ( subtitle = "There is no linear relationship, the graphic is spread", color = "darkgray", size = 8) +
theme( plot.subtitle = element_text( color = "darkgray",
size = 10) )
cor(df.clean$ShareWomen, df.clean$Part_time, method = "spearman")
ggplot(data = df.clean) +
geom_point( aes( x = ShareWomen, y = Part_time),
color = "darkblue") +
labs( title = "Share of Women vs. Part-Time jobs",
subtitle = "The relationship between the variables is slightly weak [0.33],\n siggesting that when the share of women is higher also there are more part-jobs") +
theme( plot.subtitle = element_text( color = "darkgray", size = 8) )
cor(df.clean$ShareWomen, df.clean$Median)
cor(df.clean$ShareWomen, df.clean$Low_wage_jobs)
ggplot(data = df.clean) +
geom_point( aes( x = ShareWomen, y = Low_wage_jobs,
color = "Low Wage Jobs"),
alpha = 1, shape = "o", size = 2) +
geom_point( aes( x = ShareWomen, y = Median,
color = "Median Salary"), alpha = 0.5) +
labs(title = "Share of women vs. low wage, and vs. Median Salary",
y = "", color = "Share of Women vs.:") +
scale_color_manual(values = c("Low Wage Jobs" = "darkblue",
"Median Salary" = "darkred") ) +
theme(legend.title = element_text())
df.clean <- df.clean %>%
mutate( ShareWomen_cat = ifelse(ShareWomen > 0.5, "higher", "lower") )
df.higher.w <- df.clean %>%
filter( ShareWomen_cat == "higher") %>%
select( Major, Major_category, ShareWomen,
ShareWomen_cat, Low_wage_jobs, Median)
df.lower.w <- df.clean %>%
filter( ShareWomen_cat == "lower") %>%
select( Major, Major_category, ShareWomen,
ShareWomen_cat, Low_wage_jobs, Median)
ks.test( df.higher.w$Low_wage_jobs, "pnorm") %>% suppressWarnings()
ks.test( df.lower.w$Low_wage_jobs, "pnorm" ) %>% suppressWarnings()
ks.test( df.higher.w$Median, "pnorm" ) %>% suppressWarnings()
ks.test( df.lower.w$Median, "pnorm" ) %>% suppressWarnings()
t.test()
df.higher.samp <- df.higher.w %>%
rep_sample_n( size = 1000, reps = 200, replace = TRUE ) %>%
summarize( mu_Median = mean(Median),
mu_Low_wage = mean(Low_wage_jobs) )
df.lower.samp <- df.lower.w %>%
rep_sample_n( size = 1000, reps = 200, replace = TRUE ) %>%
summarize( mu_Median = mean(Median),
mu_Low_wage = mean(Low_wage_jobs) )
df.higher.samp <- df.higher.w %>%
rep_sample_n( size = 1000, reps = 200, replace = TRUE ) %>%
summarize( mu_Median = mean(Median),
mu_Low_wage = mean(Low_wage_jobs) )
df.lower.samp <- df.lower.w %>%
rep_sample_n( size = 1000, reps = 200, replace = TRUE ) %>%
summarize( mu_Median = mean(Median),
mu_Low_wage = mean(Low_wage_jobs) )
shapiro.test(df.lower.samp$mu_Median)
shapiro.test(df.higher.samp$mu_Median)
shapiro.test(df.lower.samp$mu_Low_wage)
shapiro.test(df.higher.samp$mu_Low_wage)
ks.test( df.higher.w$Low_wage_jobs, "pnorm") %>% suppressWarnings()
ks.test( df.lower.w$Low_wage_jobs, "pnorm" ) %>% suppressWarnings()
ks.test( df.higher.w$Median, "pnorm" ) %>% suppressWarnings()
ks.test( df.lower.w$Median, "pnorm" ) %>% suppressWarnings()
with(c(df.lower.samp, df.higher.samp),
car::leveneTest(mu_Median) )
car::leveneTest(df.lower.samp$mu_Median, df.higher.samp$mu_Median)
t.test(df.higher.samp$mu_Median, df.lower.samp$mu_Median)
t.test(df.higher.samp$mu_Low_wage, df.lower.samp$mu_Low_wage)
gc()
library(tidyverse, quietly = TRUE)
library(skimr, quietly = TRUE)
library(statsr, quietly = TRUE)
library(GGally, quietly = TRUE)
library(corrplot, quietly = TRUE)
# Reading a csv from a web
url <- "https://raw.githubusercontent.com/fivethirtyeight/data/master/college-majors/recent-grads.csv"
df <- read_csv(url)
df.original <- df
df %>%
head()
glimpse(df)
cols.factor <- c("Major", "Major_code", "Major_category")
df <- df %>%
mutate_at(cols.factor, factor)
options(scipen=999, digits=4)
stats <- skim(df)
stats$numeric.sd / stats$numeric.mean
# The returned NA values are the character/factor variables
# Descriptive statistics
skim(df)
df[which(is.na(df$Total)),]
df.clean <- df %>% drop_na()
dim(df.clean)
for (var in colnames(select_if(df.clean, is.numeric)) ) {
g = ggplot(df.clean) +
geom_histogram( aes( unlist(df.clean[, var]) ), bins=20,
fill = "darkblue", color = "lightblue", alpha = 0.5) +
labs( title = paste("Histogram of", var),
x = var)
plot(g)
}
for ( var in colnames( select_if(df.clean, is.numeric) ) ) {
g = ggplot(df.clean) +
geom_boxplot( aes( y = unlist(df.clean[, var]) ),
fill = "lightblue", color = "blue") +
labs(title = paste("Boxplot of", var),
y = var)
plot(g)
}
for (var in colnames( select_if(df.clean, is.numeric)) ) {
g = ggplot(df.clean, aes( sample = unlist( df.clean[, var])) ) +
stat_qq() +
stat_qq_line() +
labs( title = paste("QQ-plot of", var) )
plot(g)
}
norm.stats <- data.frame()
for (var in colnames( select_if( df.clean, is.numeric) ) ) {
ks <- ks.test( unlist( df.clean[, var] ), y = pnorm)
sh <- shapiro.test( unlist( df.clean[, var]) )
vals <- data.frame(
ks_test = sprintf("%6.5f" ,c(ks$p.value)),
shapiro_test = sprintf("%6.5f", c(sh$p.value) ),
row.names = var
)
norm.stats <- bind_rows(norm.stats, vals)
}
remove(ks)
remove(sh)
remove(vals)
norm.stats
df.clean %>%
select(Men, Women, Part_time, Unemployment_rate,
Non_college_jobs, Low_wage_jobs) %>%
ggpairs()
corrs <- round( cor(df.clean[, -c(1, 2, 3, 7)]), 3)
corrplot (corrs, method = "number", type = "lower",
tl.cex = 0.8, number.cex = 0.6)
# Selecting top 10
top10.hig.emp <- df.clean %>%
select(Major, Unemployment_rate) %>%
arrange( desc(Unemployment_rate) ) %>%
head(10)
# Selecting top 10
top10.low.emp <- df.clean %>%
select(Major, Unemployment_rate) %>%
arrange( Unemployment_rate ) %>%
head(10)
top10.low.emp
# plot top 10 higher Unemployment rate
ggplot(top10.hig.emp) +
geom_col( aes(x = Unemployment_rate,
y = reorder( Major, +Unemployment_rate) ),
color = "darkblue", fill = "lightblue" ) +
labs( y = "Major" ) +
geom_text( aes( x = Unemployment_rate,
y = Major, label = round(Unemployment_rate, 3) ),
size = 2, hjust = 1.2) +
ggtitle("Unemployment rate by Major")
# plot top 10 lower Unemployment rate
ggplot(top10.low.emp) +
geom_col( aes(x = Unemployment_rate,
y = reorder( Major, -Unemployment_rate) ),
color = "darkblue", fill = "lightblue" ) +
labs( y = "Major" ) +
geom_text( aes( x = Unemployment_rate,
y = Major, label = round(Unemployment_rate, 3) ),
size = 2, hjust = 1.2) +
ggtitle("Unemployment rate by Major")
top10.hig.prop <- df.clean %>%
mutate (prop = Total / sum(Total) ) %>%
select (Major, Unemployment_rate, prop) %>%
arrange(desc(prop), desc(Unemployment_rate)) %>%
head(10)
# plot top 10 higher Unemployment rate by proportion
ggplot(top10.hig.prop) +
geom_col( aes(x = Unemployment_rate,
y = reorder( Major, +Unemployment_rate) ),
color = "darkblue", fill = "lightblue" ) +
labs( y = "Major" ) +
geom_text( aes( x = Unemployment_rate,
y = Major, label = round(Unemployment_rate, 3) ),
size = 2, hjust = 1.2) +
ggtitle("Unemployment rate by Major")
top10.low.prop <- df.clean %>%
mutate (prop = Total / sum(Total) ) %>%
select (Major, Unemployment_rate, prop) %>%
arrange(desc(prop), Unemployment_rate) %>%
head(10)
# plot top 10 lower Unemployment rate by proportion
ggplot(top10.low.prop) +
geom_col( aes(x = Unemployment_rate,
y = reorder( Major, -Unemployment_rate) ),
color = "darkblue", fill = "lightblue" ) +
labs( y = "Major" ) +
geom_text( aes( x = Unemployment_rate,
y = Major, label = round(Unemployment_rate, 3) ),
size = 2, hjust = 1.2) +
ggtitle("Unemployment rate by Major")
df.clean <- df.clean %>%
mutate ( College_jobs_pct = College_jobs / (College_jobs + Non_college_jobs),
Employees_pct = Total / sum(Total) )
df.clean %>%
select(Major_category, Major, College_jobs_pct) %>%
group_by(Major_category) %>%
summarize(mean_college_jobs_pct = mean(College_jobs_pct)) %>%
arrange(desc(mean_college_jobs_pct))
df.clean <- df.clean %>%
group_by(Major_category) %>%
mutate( Salary_mdn = median(Median) )
ggplot(data = df.clean) +
geom_boxplot( aes( x = reorder(Major_category, Salary_mdn),
y = Median),
fill = "lightblue", color = "darkblue") +
labs( x = "Major_category" ) +
ggtitle ("Median by Major Category") +
theme( axis.text.x = element_text( angle = 45, hjust = 1.2 ) ) +
expand_limits( x = c(0, NA), y = c(0, NA) ) +
scale_y_continuous( labels = scales::comma )
pairwise.wilcox.test(df.clean$Median, df.clean$Major_category, p.adjust.method = "holm") %>% suppressWarnings()
#cor(df.clean$ShareWomen, df.clean$Unemployment_rate, method = "pearson")
cor(df.clean$ShareWomen, df.clean$Unemployment_rate,
method = "spearman")
ggplot( data = df.clean ) +
geom_point( aes( x = ShareWomen, y = Unemployment_rate ),
color = "darkblue") +
ggtitle ("Share of women vs. Unemployment rate") +
labs ( subtitle = "There is no linear relationship, the graphic is spread", color = "darkgray", size = 8) +
theme( plot.subtitle = element_text( color = "darkgray",
size = 10) )
cor(df.clean$ShareWomen, df.clean$Part_time, method = "spearman")
ggplot(data = df.clean) +
geom_point( aes( x = ShareWomen, y = Part_time),
color = "darkblue") +
labs( title = "Share of Women vs. Part-Time jobs",
subtitle = "The relationship between the variables is slightly weak [0.33],\n siggesting that when the share of women is higher also there are more part-jobs") +
theme( plot.subtitle = element_text( color = "darkgray", size = 8) )
cor(df.clean$ShareWomen, df.clean$Median)
cor(df.clean$ShareWomen, df.clean$Low_wage_jobs)
ggplot(data = df.clean) +
geom_point( aes( x = ShareWomen, y = Low_wage_jobs,
color = "Low Wage Jobs"),
alpha = 1, shape = "o", size = 2) +
geom_point( aes( x = ShareWomen, y = Median,
color = "Median Salary"), alpha = 0.5) +
labs(title = "Share of women vs. low wage, and vs. Median Salary",
y = "", color = "Share of Women vs.:") +
scale_color_manual(values = c("Low Wage Jobs" = "darkblue",
"Median Salary" = "darkred") ) +
theme(legend.title = element_text())
df.clean <- df.clean %>%
mutate( ShareWomen_cat = ifelse(ShareWomen > 0.5, "higher", "lower") )
df.higher.w <- df.clean %>%
filter( ShareWomen_cat == "higher") %>%
select( Major, Major_category, ShareWomen,
ShareWomen_cat, Low_wage_jobs, Median)
df.lower.w <- df.clean %>%
filter( ShareWomen_cat == "lower") %>%
select( Major, Major_category, ShareWomen,
ShareWomen_cat, Low_wage_jobs, Median)
ks.test( df.higher.w$Low_wage_jobs, "pnorm") %>% suppressWarnings()
ks.test( df.lower.w$Low_wage_jobs, "pnorm" ) %>% suppressWarnings()
ks.test( df.higher.w$Median, "pnorm" ) %>% suppressWarnings()
ks.test( df.lower.w$Median, "pnorm" ) %>% suppressWarnings()
with(df.clean, car::leveneTest(Median, ShareWomen_cat) )  %>% suppressWarnings()
with(df.clean, car::leveneTest(Low_wage_jobs, ShareWomen_cat) )  %>% suppressWarnings()
wilcox.test(df.higher.w$Median, df.lower.w$Median)
cat("Median of Higher Share Woman: ", median(df.higher.w$Median),
"\nMedian of Lower Share Woman: ", median(df.lower.w$Median), "\n" )
t.test(df.higher.w$Low_wage_jobs, df.lower.w$Low_wage_jobs)
df.higher.samp <- df.higher.w %>%
rep_sample_n( size = 1000, reps = 200, replace = TRUE ) %>%
summarize( mu_Median = mean(Median),
mu_Low_wage = mean(Low_wage_jobs) )
df.lower.samp <- df.lower.w %>%
rep_sample_n( size = 1000, reps = 200, replace = TRUE ) %>%
summarize( mu_Median = mean(Median),
mu_Low_wage = mean(Low_wage_jobs) )
shapiro.test(df.lower.samp$mu_Median)
shapiro.test(df.higher.samp$mu_Median)
shapiro.test(df.lower.samp$mu_Low_wage)
shapiro.test(df.higher.samp$mu_Low_wage)
t.test(df.higher.samp$mu_Median, df.lower.samp$mu_Median)
t.test(df.higher.samp$mu_Low_wage, df.lower.samp$mu_Low_wage)
df.salary.w <- df.clean %>%
group_by(ShareWomen_cat) %>%
summarize(Salary_mean = mean(Median) )
ggplot( data = df.clean ) +
geom_boxplot( aes( x = ShareWomen_cat, y = Median),
fill = "lightblue", color = "darkblue" ) +
labs( title = "Average Salary When
ShareWomen is lower/higher than 50%",
subtitle = "The average salary for majors with more women enrolled \n
is lower than the majors with less women, reinforcing the perception \n
that women are getting lower salaries.",
x = "50% Share of Women",
y = "Mean Salary" ) +
geom_text( data = df.salary.w, aes( x = ShareWomen_cat,
y = Salary_mean,
label = round(Salary_mean)),
size = 2.2, vjust = 1, color = "black" ) +
theme(plot.subtitle = element_text( color = "darkgray", size = 9 ) )
gc()
library(tidyverse)
library(datasets)
library(patchwork)
data("mtcars")
ggplot(mtcars) +
geom_histogram(
mapping = aes( x = mpg ),
bins = 20,
color = "lightblue",
fill = "darkblue",
alpha = 0.6
) +
ggtitle( "Whistogram of Miles per Gallon" )
ggplot( data = mtcars ) +
geom_boxplot( aes( y = mpg ), fill = "lightblue", color = "darkblue" ) +
ggtitle( "Boxplot of miles per gallon")
View(mtcars)
ggplot( mtcars ) +
geom_boxplot( aes( x = factor(am),
y = mpg ), fill = "lightblue" ) +
labs( x = "Transmission",
title = "Comparison betweeen automatic and manual transmission on MPG",
subtitle = "" )
ggplot( mtcars ) +
geom_boxplot( aes( x = factor(am),
y = mpg ), fill = "lightblue" ) +
labs( x = "Transmission",
title = "Comparison betweeen automatic and manual transmission on MPG",
subtitle = "The median of manual cars (1) is higher" )
ggplot( data = mtcars ) +
geom_point( aes( x = wt, y = mpg ),
color = "darkblue",
size = 4,
shape = 15, # squares
alpha = 0.7 ) +
labs ( x = "Weight of the cars",
y = "Milles per Gallon",
title = "How the weight affects MPG in cars?",
subtitle = "As the weight increases, the car will maje less MPG")
ggplot( data = mtcars ) +
geom_point( aes( x = wt, y = mpg ),
color = "darkblue",
size = 4,
shape = 12, # squares
alpha = 0.7 ) +
labs ( x = "Weight of the cars",
y = "Milles per Gallon",
title = "How the weight affects MPG in cars?",
subtitle = "As the weight increases, the car will maje less MPG")
ggplot( data = mtcars ) +
geom_point( aes( x = wt, y = mpg ),
color = "darkblue",
size = 4,
shape = 11, # squares
alpha = 0.7 ) +
labs ( x = "Weight of the cars",
y = "Milles per Gallon",
title = "How the weight affects MPG in cars?",
subtitle = "As the weight increases, the car will maje less MPG")
ggplot( data = mtcars ) +
geom_point( aes( x = wt, y = mpg ),
color = "darkblue",
size = 4,
shape = 7, # squares
alpha = 0.7 ) +
labs ( x = "Weight of the cars",
y = "Milles per Gallon",
title = "How the weight affects MPG in cars?",
subtitle = "As the weight increases, the car will maje less MPG")
ggplot( data = mtcars ) +
geom_point( aes( x = wt, y = mpg ),
color = "darkblue",
size = 4,
shape = 15, # squares
alpha = 0.7 ) +
labs ( x = "Weight of the cars",
y = "Milles per Gallon",
title = "How the weight affects MPG in cars?",
subtitle = "As the weight increases, the car will maje less MPG")
ggplot( mtcars ) +
geom_boxplot( aes( x = factor(am),
y = mpg ), fill = "lightblue" ) +
labs( x = "Transmission",
title = "Comparison betweeen automatic and manual transmission on MPG",
subtitle = "The median of manual cars (1) is higher" )
ggplot( mtcars ) +
geom_bar( aes( x = factor(am),
fill = factor(am) ) ) +
# Fill in 'aes' using the same factor means color per category
labs( x = "Automatic(0) | Manual(1)" ) +
ggtitle( "Count of observations by transmission type" )
ggplot( mtcars ) +
geom_bar( aes( x = factor(am),
y = mpg,
fill = factor(am) ),
stat = "summary", fun = "mean" ) # To use the mean on 'y' axis
ggplot( mtcars ) +
stat_summary( aes( x = factor(am),
y = mpg,
fill = factor(am) ),
fun = "mean",
geom = "bar" )
ggplot( mtcars ) +
geom_col( aes( x = factor(am),
y = mpg,
fill = factor(am) ) ) +
labs( x = "Automatic(0) | Manual(1)" )
ggplot( mtcars ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "stack" ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "dodge" ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "fill" ) %>%
gridExtra::grid.arrange(ncol = 3)
ggplot( mtcars ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "stack" ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "dodge" ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "fill" )
ggplot( mtcars ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "stack" )
ggplot( mtcars ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "dodge" )
ggplot( mtcars ) +
geom_bar( aes( x = factor(cyl), fill = factor(vs) ),
position = "fill" )
df.line <- data.frame(
month = seq(1, 12, 1),
sales = rlnorm(12),
sales2 = rgamma(12)
)
df.line <- data.frame(
month = seq(1, 12, 1),
sales = rlnorm(12),
sales2 = rgamma(12, 1)
)
df.line[1:5,]
ggplot( df.line ) +
geom_line( aes( x = month,
y = sales,
group = 1),
size = 1,
color = "darkblue" ) +
ggtitle( "Car sales throughout the months")
ggplot( df.line ) +
geom_line( aes( x = month,
y = sales,
group = 1),
linewidth = 1,
color = "darkblue" ) +
ggtitle( "Car sales throughout the months")
ggplot( df.line ) +
geom_line( aes( x = month,
y = sales,
group = 1,
color = "Sales year 1"),
linewidth = 1,
linetype = 2) +
geom_line( aes( x = month,
y = sales2,
group = 1,
color = "Sales year 2"),
linewidth = 1,
linetype = 1) +
ggtitle( "Car sales throughout the monts" ) +
labs( subtitle = "Two year comparison" )
ggplot( df.line ) +
geom_line( aes( x = month,
y = sales,
group = 1,
color = "Sales year 1"), # the label for this line
linewidth = 1,
linetype = 2) +
geom_line( aes( x = month,
y = sales2,
group = 1,
color = "Sales year 2"),
linewidth = 1,
linetype = 1) +
ggtitle( "Car sales throughout the monts" ) +
labs( subtitle = "Two year comparison",
color = "Sales Year")
